<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    

    <title>Main Menu</title>
	<link rel="stylesheet" href="cauStyle.css">

	    <!-- Firebase library -->
    <script src='https://cdn.firebase.com/js/client/2.4.1/firebase.js'></script>

	
	<!--Links for Bootstrap-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
  </head>
  
  
  
<body id ="main" data-spy="scroll" data-target=".navbar" data-offset="50">

<!-- Jumbotron
    ================================================== -->
	<div class="container-fluid" style="background-color:#003541;color:#fff;height:200px;">
		<h1>Welcome <span id="usernameText">username!</span></h1>
	</div>
	
	
	
<!-- Affix Navigation Bar
    ================================================== -->
	<nav class="navbar navbar-inverse" data-spy="affix" data-offset-top="197" id="navigationColour">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>                        
				</button>
				<img src="avatars/logo.png" alt="logo" id="Logo">
				<p class="navbar-brand">Cards Against University</p>
			</div>
			
			<div>
			<div class="collapse navbar-collapse" id="myNavbar">
				<!-- Navigation options centered -->
				<ul class="nav navbar-nav">
					<li><a href="#section1">Home</a></li>
					<li><a href="#" onclick="checkNumOfPlrs();" data-toggle='modal' data-target="#myModal">Play</a></li>
					<li><a href="leaderboard.php">Leaderboard</a></li>
					<li><a href="#section2">How to Play</a></li>
					<li class="dropdown navbar-right" id="profile"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Profile <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="profilePage.html">Personal Stats</a></li>
						</ul>
					</li>
				</ul>
				<!-- Navigation option to the right -->
				<ul class="nav navbar-nav navbar-right">
					<li onclick="logOut()"><a href="index.html"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
				</ul>
			</div>
			</div>
		</div>
	</nav><!-- ./navigation Bar -->    

	
	<!-- 'About' Sections
    ================================================== -->
	
	<!--Section 1 = "About"-->
	<div id="section1" class="container-fluid">
		<h1 id="opening">Do you have what it takes to be truly horrible?</h1>
		</br>
		</br>
		<p>The aim of the game is simple. Each round a black scenario card is revealed and everyone in the group answers with their best white card. 
		 If your opponents think you are the funniest smart-arse of the group, you could be walking away with credits towards your score and cold, hard, [*virtual*] cash</p>
		</br>
		<p>Test yourself to see if you are quick-witted enough to take on your college classmates and come out the <del> biggest dickhead</del> winner!
		<p>Here at CAU we encourage indecent thoughts about sexism, racism, class, religious beliefs ...as long as you just keep it on the cards!</p>
	</div>
	
	<!--Section 2 = "Dummies Guide"-->
	<div id="section2" class="container-fluid">
		<h1 id="opening">The Dummies Guide to CAU: a.k.a. what to click and when!</h1>
		
		<div class="container-fluid">
			<div class="col-sm-6" id="leftside">
				<p>1. To start a game, just click the "Play" option in the navigation bar</p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/playbutton.png" alt="Play" >
			</div>
		</div>
		
		
		<div class="container-fluid">
			<div class="col-sm-6" id="leftside">
				<p>2. You will be thrown into the fiery pit of satire with four other Maynooth students. You can see who you are playing against on the sidebar to the left</p>
				</br>
				</br>
				<p>3. You have just 30seconds to read your white cards and decide which one best answers the black card. Click on your choice and press submit </p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/gamepage.png" alt="Game Page" width="78%" height="78%">
			</div>
		</div>
		
		
		<div class="container-fluid">
			<div class="col-sm-6" id="leftside">
				<p>4. At this point, your submission is on lock-down...don don DON.</p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/modal.png" alt="Modal" width="78%" height="78%">
			</div>
		</div>
		
		
		<div class="container-fluid">
			<div class="col-sm-6" id="moreMargin">
				<p>5. When everyone has submitted the judging will commence and you can see all your opponents' submissions. You must click which one you think is best and submit your vote.</p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/castvote.png" alt="Cast Vote" width="78%" height="78%">
			</div>
		</div>
		
		
		<div class="container-fluid">
			<div class="col-sm-6" id="moreMargin">
				<p>6. After everyone has voted, the winner is announced! If you are that lucky guy or gal, you win credits towards your virtual degree and cash to spend on special functions in the game</p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/winneravatar.png" alt="Winner" width="40%" height="40%">
			</div>
		</div>
	</div>
	
	
	<!--Section 3 = "Special Function"-->
	<div id="section3" class="container-fluid">
		<h1 id="opening">Special Functions you say?</h1>
		</br>
		<p>If you are the lucky holder of coins, you can spend them in two ways:</p>
		<p>1. You can shuffle your white cards for ???coins, which means you get new set of cards to choose from.</p>
		<p>2. You can buy a blank white card for ???coins and submit your own answer if you feel your other white cards just wont do.</p>
	</div>
	
	
	
	<!--Section 4 = "Leaderboard"-->
	<div id="section4" class="container-fluid">
		<h1 id="opening">Leaderboard</h1>
		
		<div class="container-fluid">
			<div class="col-sm-6" id="leftside">
				<p>If you are on this Home page or you have just finished a game, you can access the Leaderboard from the navigation menu</p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/leaderboard.png" alt="Leaderboard">
			</div>
		</div>
	</div>
	
	<!--Section 5 = "Personal Stats"-->
	<div id="section5" class="container-fluid">
		<h1 id="opening">Personal Stats</h1>
		
		<div class="container-fluid">
			<div class="col-sm-6" id="leftside">
				<p>If you are on this Home page or you have just finished a game, you can access your Personal Stats from the navigation menu</p>
			</div>
			<div class="col-sm-6" id="rightside">
				<img src="aboutImages/personalstats.png" alt="Personal Stats">
			</div>
		</div>
	</div>
    </div><!-- ./about sections -->

	<!-- Waiting Modal -->
	  <div class="modal fade" id="myModal" role="dialog" data-keyboard="false">
	    <div class="modal-dialog">
	    
	      <!-- Modal content-->
	      <div class="modal-content">
		<div class="modal-header">
		  <h4 class="modal-title">Your game will begin shortly</h4>
		</div>
		<div class="modal-body">
		  <p id="modbod"></p>
		</div>
	      </div>
	      
	    </div>
	  </div>

	
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <script src="../../assets/js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>

    <script type="text/javascript">

    var myDataRef = new Firebase('hhttps://cau-maynooth.firebaseio.com');

  
	//Called when the play button is pressed
	function checkNumOfPlrs(){ // Checking the number of players in the game
    	var ref = new Firebase('hhttps://cau-maynooth.firebaseio.com');  // ref to Firebase
    	var subclass = ref.child("NumOfPlayers"); // Add a new node to Firebase if not already created
    	var count = subclass.child("Count") // Add a new node to Firebase if not already created for count
    	ref = new Firebase('hhttps://cau-maynooth.firebaseio.com/NumOfPlayers/Count/count'); // ref to count variable in Firebase
    	ref.once("value", function (snapshot) {  // Check the current state of Firebase once
    		numOfPlayers = snapshot.val().count; // Store the number of players in a variable
    		numOfPlayers++; //  Add current gamer to the count
    		ref.update({"count":numOfPlayers});
    		updateGameRef();
    		checkGame();
    	});    	
    }
	
	//This keeps updating how many users are waiting to play, and once it hits 5 all players get into the game page
	function checkGame(){
		ref = new Firebase('hhttps://cau-maynooth.firebaseio.com/NumOfPlayers/Count/count'); // ref to count variable in Firebase
		ref.on("value", function (snapshot) {
			numOfPlayers = snapshot.val().count;
			console.log("checking");
			if(numOfPlayers%5==0){
				//localStorage.setItem("gameRef", gameNum);
				location.href="gameInPlay.html";
				ref.off();
			}else{
				document.getElementById('modbod').innerHTML = "Waiting for "+ (5-(numOfPlayers%5)) + " more player(s)";				
				console.log("Not 5 yet :" + numOfPlayers);
			}
		}); 
	}


	function updateGameRef(){
		var updateGame="";
		gameNo = new Firebase('hhttps://cau-maynooth.firebaseio.com/GameCounter/count');
		gameNo.once("value", function(snapshot){
			updateGame=snapshot.val().count;
			updateGame = updateGame+1;
			updateGame = "Game " + updateGame;
			console.log("updateGame: " + updateGame);
			fireUID = getUID();
			var xhttp = new XMLHttpRequest();     //make a new request object
    			xhttp.onreadystatechange = function(){      //if the response/php is successful, change page
      			if(xhttp.readyState == 4 && xhttp.status == 200){
				localStorage.setItem("GameRefAv", updateGame);
      			} 
   			};
    			xhttp.open("POST", "setGameRef.php", true);      //wrap the request in POST
    			xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    			xhttp.send("fireUID="+fireUID+"&gameRef="+updateGame);  //send the user details in the request
		});
	
	}


   //special function just to get the user's FirebaseUID after they have registered
  function getUID(){
    var myDataRef = new Firebase('hhttps://cau-maynooth.firebaseio.com');
    var authData = myDataRef.getAuth();
    return authData.uid;
  }
	

    function logOut(){ // Method to log out of Firebase upon click of button

    	myDataRef.unauth();
    	window.location="index.html";
    }
	
	
	<!-- Changing the "Welcome username!" to the user's personalized username
	var userNameRef = new Firebase('https://cau-maynooth.firebaseio.com/users');				//DB Reference
	var uEmail = localStorage.getItem("Email");													//get the email of the user that just logged in/registered
	var user;
	userNameRef.orderByChild("email").equalTo(uEmail).on("child_added", function(snapshot){		//get the user object from the DB with the same email as above
		console.log(snapshot.val());
		user = snapshot.val().username;
		document.getElementById("usernameText").textContent = user;								//change <span> username </span> to the personalised name
	}, function (errorObject) {
		console.log("The read failed: " + errorObject.code);
	});

    </script>
  </body>
</html>
