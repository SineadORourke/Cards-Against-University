<!DOCTYPE html>

<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  
    <link rel="stylesheet" href="cauStyle.css">
      
    <!--Links for Bootstrap-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src='https://cdn.firebase.com/js/client/2.4.1/firebase.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <title>Play</title>
  
  </head>
  
<!--This page is not yet fully responsive-->
<body data-spy="scroll" data-target=".navbar" data-offset="50" id="main" onload="SetGameUp()">   <!--onload="getScenarioCard"-->
  
  <!-- Navigation Bar
    ================================================== -->
  <nav class="navbar navbar-inverse" data-spy="affix" data-offset-top="197" id="navigationColour">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
        </button>
        <img src="defaultlogo.png" alt="logo" id="Logo">
        <p class="navbar-brand">Cards Against University : Playing</p>
      </div>
    
      <div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <!-- Navigation options centered      <--Can center "Playing"
        <ul class="nav navbar-nav">
          <li><a href="#">Playing</a></li>
        </ul>-->
        
        <!-- Navigation option to the right -->
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Quit Game</a></li>
          <li class="dropdown navbar-right" id="profile"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Profile <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li>Current credits</li>
              <li>Coin counter</li>
            </ul>
          </li>
        </ul>
      </div>
      </div>
    </div>
  </nav><!-- ./navigation Bar -->    
  
  
  
  <div class="container-fluid"> <!--Black card, white cards, timer and avatars are all wrapped in this container-->

  <!-- Black card 
    ================================================== -->  
	<div class="col-sm-10" id="leftCards">  <!--Black card, white cards and submit button are in this col (Responsive)-->
      <center>
        <canvas id="myBlackCanvas" width="0" height="0" style="border:1px solid #000;">
		Your browser does not support the HTML5 canvas tag.
		</canvas>
      
	<!-- ./black card -->

  
  <!-- White cards
    ================================================== -->
	
	<div id="whitecards">
	<canvas id="myCanvas1" width="0" height="0" style="border:1px solid #000;"></canvas>
	<canvas id="myCanvas2" width="0" height="0" style="border:1px solid #000;"></canvas>
	<canvas id="myCanvas3" width="0" height="0" style="border:1px solid #000;"></canvas>
	<canvas id="myCanvas4" width="0" height="0" style="border:1px solid #000;"></canvas>
	<canvas id="myCanvas5" width="0" height="0" style="border:1px solid #000;"></canvas>
	</div>
	<!-- ./white cards -->
    
	
   <!-- Submit Button
    ================================================== -->

        <div id="submitAnswerBtn">
          <button class="submitbutton" onclick="submitAnswer()" id="submit1" data-toggle="modal" data-target="#myModal">Submit</button>
        </div>
      
	  </center>
	</div>

	<!-- ./submit button -->

 
 
	<!-- Timer + Group Avatars + Shuffle Button
    ================================================== -->
	<div class="table-responsive col-sm-2" id="rightBar"> <!--Timer and Avatars are in this col (Responsive)-->
	<table class="table" id="AvatarTable">				<!--Timer and Avatars are structured in a table-->
		<tbody>
			<tr id="TimerRow">							<!--Timer-->
				<td id="timer"></td>
			</tr>
			
			<tr id="avatarRow">							<!--Avatars-->
				<td id = "AvatarData">
					<figure>
					<img src="defaultplayer.png" alt="Player 1" width="100" height="90">
					<figcaption>Player 1</figcaption>
					</figure>
				</td>
			</tr>
			<tr id="avatarRow">
				<td id = "AvatarData">
					<figure>
					<img src="defaultplayer.png" alt="Player 2" width="100" height="90">
					<figcaption>Player 2</figcaption>
					</figure>
				</td>
			</tr>
			<tr id="avatarRow">
				<td id = "AvatarData">
					<figure>
					<img src="defaultplayer.png" alt="Player 3" width="100" height="90">
					<figcaption>Player 3</figcaption>
					</figure>
				</td>
			</tr>
			<tr id="avatarRow">
				<td id = "AvatarData">
					<figure>
					<img src="defaultplayer.png" alt="Player 4" width="100" height="90">
					<figcaption>Player 4</figcaption>
					</figure>
				</td>
			</tr>
			<tr id="shuffleRow">						<!--Shuffle Button-->
				<td id="shuffleBtn">
					<button class="submitbutton" id="shuffleButton" data-toggle="modal" data-target="#shuffleModal">Shuffle</button>
				</td>
			</tr>
		</tbody>
	</table>
	</div>
	</div> 
    <!-- ./timer + group avatars + shuffle button -->
<!--End of responsive code-->
	
	
	
	
	
    <!-- modal code
       ===================================== -->

 <div id="myModal" class="modal fade" role="dialog"  data-keyboard="false" data-backdrop="static">
   <div class="modal-dialog">
 
     <!-- Modal content-->
     <div class="modal-content">
       <div class="modal-header">
        <div id='timer2'>
        </div> 
         <h4 class="modal-title">Your card has been submitted</h4>
       </div>
       <div class="modal-body">
         <p>Waiting for other players to submit their white card</p>
       </div>
       
     </div>
 
   </div>
 </div>
 
 
 <!-- Shuffle Modal -->
  <div class="modal fade" id="shuffleModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Shuffle Function</h4>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to spend 3 coins on a new set of cards?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" onclick="shuffleCards()" data-dismiss="modal">Yes</button>
		  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
  </div>
  
  
  <!-- JS code for Timer
    ================================================== -->
  <script>  
    var timeLeft = 30;
    var elem = document.getElementById('timer');
    var elem2 = document.getElementById('timer2');
    var timerId = setInterval(countdown, 1000);
    function countdown() {
      if (timeLeft == 0) {
        clearTimeout(timerId);
        alert("Times up!")
        document.getElementById('submit1').click();
        location.href="JudgingPage.html"
        //document.getElementById("submit1").disabled = true;
        
      } else {
        elem.innerHTML = timeLeft + ' seconds remaining';
        elem2.innerHTML = timeLeft + ' seconds remaining';
        timeLeft--;
      }
    } <!--./timer -->
	
	
	
	
	
	<!-- ========== CANVAS CARDS ========== -->
	<!--I know that this looks like a lot of code, but really about 90% just draws the card graphics,
	<!--fills the colour of the cards, gets the text on to the cards.
	
	<!--When the text is pulled from Firebase, 2 things happen to it:
	<!--	1. it essentially gets painted on to the card graphics 
	<!--	2. it also gets saved in the innerHTML of the individual canvases (so it is easy to the setAnswer() and submitAnswer() methods like before)-->
	
	
	
	//These variables decide the size of the cards
    var blockSize = 40;					//the num of pixels per block
	var canvasWidth = blockSize * 6; 	//the num of blocks across
	var canvasHeight = blockSize * 8;	//the numb of blocks down
	
	var answer = "";	
	var ID = "";				//empty string that saves the clicked card later
	
	
	
	
	<!--Set up Black Card CANVAS-->
	var b = document.getElementById("myBlackCanvas");
	b.width = canvasWidth;				//set size of black card
    b.height = canvasHeight;
	
	var ctxBlack = b.getContext("2d");	//get black card context
      	ctxBlack.fillStyle = "#000";	//fill background black
		ctxBlack.fillRect(s(0),s(0),s(6),s(8));	//fill the entire canvas (black)
        ctxBlack.font = "20px Helvetica";		//font
      	ctxBlack.fillStyle = '#FFF';			//font colour
      	ctxBlack.textAlign = 'center';			//center text on black card
          
        
		//Pull text from Firebase
		var ref = new Firebase("https://cau-maynooth.firebaseio.com/blackCards/card" + randNum());
		ref.on("value", function(snapshot) {
        var scenarioCard = snapshot.val();
        //console.log("Message from server; ", scenarioCard);
		
		//wrapText fits long inputs (mulit-line) on the card nicely
        wrapText(ctxBlack, scenarioCard, s(3), s(2), s(5), 25);
		},
        function (errorObject) {  // Deal with errors
          console.log("The read failed: " + errorObject.code);
        });
        
      
	  
	  
	// s() scales everything to size according to the set blocksize
	function s(x) {
		return x*blockSize-1;
	}
	  
	  
	 //Set the sizes of the white card canvases
    function setSize(canvas){
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;
      canvas.addEventListener("click", setAnswer); //added onclick method for white cards
    }
	
	
	//method to generate random number
	function randNum(){
		return Math.floor((Math.random() * 6) + 1);
	  }  
	  
	 
	
	//method used to pull down inputs for white cards from Firebase, then calls another method to insert
	function getWhiteText(context, id){
		var ref = new Firebase("https://cau-maynooth.firebaseio.com/whiteCards/card" + randNum());
		ref.on("value", function(snapshot) {
        var info = snapshot.val();
        //console.log("Message from server; ", info);
		
		//Saves the text inside the canvas element
		document.getElementById(id).innerHTML = info;
		
		//fillContext colours the box, adds the text (info) and wraps the text if necessary
        fillContext(context, info);		
		},
        function (errorObject) {  // Deal with errors
          console.log("The read failed: " + errorObject.code);
        });
	  }  
	  
	  
	  
	//method used to fill the white cards
    function fillContext(context, text){
      	context.fillStyle = "#FFF";				//fill background white
		context.fillRect(s(0),s(0),s(6),s(8));	//fill the whole card
        context.font = "20px Helvetica";		//font
      	context.fillStyle = '#000';				//font colour
      	context.textAlign = 'center';			//center text on card
        
        wrapText(context, text, s(3), s(2), s(5), 25); //wrap the text on the card
      }
	  
	  
	 //Method to wrap long sentences in the white cards
	function wrapText(context, text, x, y, maxWidth, lineHeight) {
        var words = text.split(' ');					//split text into array
        var line = '';									

        for(var n = 0; n < words.length; n++) {			
          var testLine = line + words[n] + ' ';
          var metrics = context.measureText(testLine);
          var testWidth = metrics.width;
          if (testWidth > maxWidth && n > 0) {
            context.fillText(line, x, y);
            line = words[n] + ' ';
            y += lineHeight;
          }
          else {
            line = testLine;
          }
        }
        context.fillText(line, x, y);
      }
	
	
	
	
	
	//This function is called when the page is loaded up
	//It creates the White card images (with the text on them)
	//When the user presses "yes" in the shuffle modal, this method is called again (overwriting the original cards)
	function newWhiteCards(){
	
		<!--Set up White cards CANVAS-->
		var c1 = document.getElementById("myCanvas1");
		var c2 = document.getElementById("myCanvas2");
		var c3 = document.getElementById("myCanvas3");
		var c4 = document.getElementById("myCanvas4");
		var c5 = document.getElementById("myCanvas5");
	
		setSize(c1);
		setSize(c2);
		setSize(c3);
		setSize(c4);
		setSize(c5);
	
		//get contexts for white cards  
		var ctx1 = c1.getContext("2d");
		var ctx2 = c2.getContext("2d");
		var ctx3 = c3.getContext("2d");
		var ctx4 = c4.getContext("2d");
		var ctx5 = c5.getContext("2d");
		
		
		//call the method to insert ("paint") text on all white cards
		getWhiteText(ctx1, "myCanvas1");	
		getWhiteText(ctx2, "myCanvas2");
		getWhiteText(ctx3, "myCanvas3");
		getWhiteText(ctx4, "myCanvas4");
		getWhiteText(ctx5, "myCanvas5");
	}
	
      
	  
	 newWhiteCards();
   
 
    function shuffleCards(){
		newWhiteCards();
	}
			
    

	<!-- ./canvas cards -->

	
	
	<!-- Card Methods -->

	// DECLARE GLOBAL VARIABLES FOR INGAME USE //
	var noOfGames = 0;
	var gameID = "";
	var authData = ref.getAuth();
	var game = "";
	var numOfPlayers = "";
	var maxPlayers = 4;
	var submissionID = "";

	function SetGameUp(){

        var ref = new Firebase("https://cau-maynooth.firebaseio.com/Game"); // Get a ref to correct locatin in Firebase database

        noOfGames++; // Upon load of page of page increase the number of games

        var noOfCurrentGames = "Game " + noOfGames; // Prepare variable to use when creating a new game on database

        game = ref.child(noOfCurrentGames); // 
        //console.log("Game is " + game);
        //console.log("Game id is; " + noOfCurrentGames);

        game.once("value", function (snapshot) {
              numOfPlayers = snapshot.numChildren();          // checks and returns the number of children under the gameID branch, i.e. How many users have submitted an answer             
        });

    }
      	
	//This method sets "answer" as the clicked canvas card
	function setAnswer(){
		answer = document.getElementById(this.id).innerHTML;
		console.log("The answer chosen is by the user is: " + answer);

	}	

	// This method submits the answer to the firebase database 
	function submitAnswer(){

		var ref = new Firebase("https://cau-maynooth.firebaseio.com/Game");

       if(answer == ""){ // Check that user has chosen a card
          alert("You must select one whitecard before clicking submit"); 
        }    
        else {

        	if ( numOfPlayers > maxPlayers) { // Check if there are 5 players already in game
              	  noOfGames++; // Increase the number of games
              	  //console.log("No of games at this stage is " + noOfGames);
              	  noOfCurrentGames = "Game " + noOfGames; // increase game count variable to use when inserting
              	  localStorage.setItem("GameRef", noOfCurrentGames);	//save the game number in local storage (So we know where to pull data down from in Judging page)
              	  console.log("GameRef is " + noOfCurrentGames);
              	  game = ref.child(noOfCurrentGames); // Store the location to push answer to, within a variable 
              	  game.push(answer); // Push user selected answer to correct location 

                  submissionID = game.key(); // store the users unique id to pass onto results page

                  //console.log("submissionID 1 = " + submissionID.key());
                  numOfPlayers = 1; // reset number of player to 1
              }
              else{ // if number of players is less than 5 submit answer
              	  //console.log("The answer before pushing is " + answer);
              	  localStorage.setItem("GameRef", noOfCurrentGames);	//save the game number in local storage (So we know where to pull data down from in Judging page)
		          gameID = game.push(answer);       // Push user selected answer to correct location and store location
		          submissionID  = gameID.key(); // stores the unq id of users submission to pass to results page
		          //console.log("SubmissionID 2 = " + submissionID );
              }
       }
       //window.location.href="JudgingPage.html"; // Move onto judging page after time has elapsed    
  }
	
      
  </script>
  
  
  <!--Firebase links-->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
  <script src='https://cdn.firebase.com/js/client/2.2.4/firebase.js'></script>
  <script src="https://cdn.firebase.com/libs/angularfire/1.1.3/angularfire.min.js"></script>

  
   <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <script src="../../assets/js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>